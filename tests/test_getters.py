import sys
import unittest

sys.path.insert(0, '..')

from src.engine.utils.getters import *

class TestValidPieces(unittest.TestCase):
	def test_get_valid_pieces_human(self):
		# Starting Board
		self.assertEqual(
			get_valid_pieces([
				['W', '*', 'W', '*', 'W', '*', 'W'], 
				['*', '_', '*', '_', '*', '_', '*'], 
				['*', '*', '_', '*', '_', '*', '*'],
				['*', '_', '*', '_', '*', '_', '*'], 
				['B', '*', 'B', '*', 'B', '*', 'B']],
				"B", True
			),
			[[4,0], [4,2], [4,4], [4,6]]
		)

		self.assertEqual(
			get_valid_pieces([
				['B', '*', 'B', '*', 'B', '*', 'B'], 
				['*', '_', '*', '_', '*', '_', '*'], 
				['*', '*', '_', '*', '_', '*', '*'],
				['*', '_', '*', '_', '*', '_', '*'], 
				['W', '*', 'W', '*', 'W', '*', 'W']],
				"W", True
			),
			[[4,0], [4,2], [4,4], [4,6]]
		)

		# When pieces are in play
		self.assertEqual(
			get_valid_pieces([
				['B', '*', 'B', '*', 'B', '*', 'B'], 
				['*', '_', '*', '_', '*', '_', '*'], 
				['*', '*', 'W', '*', '_', '*', '*'],
				['*', '_', '*', '_', '*', '_', '*'], 
				['W', '*', '_', '*', 'W', '*', 'W']],
				"W", True
			),
			[[2,2], [4,0], [4,4], [4,6]]
		)

		# Piece is blocked
		self.assertEqual(
			get_valid_pieces([
				['B', '*', 'W', '*', 'B', '*', 'B'], 
				['*', '_', '*', '_', '*', '_', '*'], 
				['*', '*', '_', '*', '_', '*', '*'],
				['*', '_', '*', '_', '*', '_', '*'], 
				['W', '*', 'W', '*', '_', '*', 'W']],
				"W", True
			),
			[[4,0], [4,2], [4,6]]
		)

	def test_get_valid_pieces_ai(self):
		# Starting Board
		self.assertEqual(
			get_valid_pieces([
				['B', '*', 'B', '*', 'B', '*', 'B'], 
				['*', '_', '*', '_', '*', '_', '*'], 
				['*', '*', '_', '*', '_', '*', '*'],
				['*', '_', '*', '_', '*', '_', '*'], 
				['w', '*', 'W', '*', 'W', '*', 'W']],
				"B", False
			),
			[[0,0], [0,2], [0,4], [0,6]]
		)
		self.assertEqual(
			get_valid_pieces([
				['W', '*', 'W', '*', 'W', '*', 'W'], 
				['*', '_', '*', '_', '*', '_', '*'], 
				['*', '*', '_', '*', '_', '*', '*'],
				['*', '_', '*', '_', '*', '_', '*'], 
				['B', '*', 'B', '*', 'B', '*', 'B']],
				"W", False
			),
			[[0,0], [0,2], [0,4], [0,6]]
		)

		# When pieces are in play
		self.assertEqual(
			get_valid_pieces([
				['W', '*', 'W', '*', '_', '*', 'W'], 
				['*', '_', '*', '_', '*', '_', '*'], 
				['*', '*', 'W', '*', '_', '*', '*'],
				['*', '_', '*', '_', '*', '_', '*'], 
				['B', '*', 'B', '*', 'B', '*', 'B']],
				"W", False
			),
			[[0,0], [0,2], [0,6], [2,2]]
		)

		# Piece is blocked
		self.assertEqual(
			get_valid_pieces([
				['W', '*', 'W', '*', '_', '*', 'W'], 
				['*', '_', '*', '_', '*', '_', '*'], 
				['*', '*', '_', '*', '_', '*', '*'],
				['*', '_', '*', '_', '*', '_', '*'], 
				['B', '*', 'B', '*', 'W', '*', 'B']],
				"W", False
			),
			[[0,0], [0,2], [0,6]]
		)

	def test_get_valid_moves_with_jump(self):
		self.assertEqual(
			get_valid_pieces([
				['_', '*', '_', '*', '_', '*', 'W'], 
				['*', '_', '*', 'W', '*', '_', '*'], 
				['*', '*', 'W', '*', 'W', '*', '*'],
				['*', '_', '*', 'B', '*', '_', '*'], 
				['B', '*', '_', '*', '_', '*', 'B']],
				"B", True
			),
			[[3,3], [4,0], [4,6]]
		)

		self.assertEqual(
			get_valid_pieces([
				['_', '*', '_', '*', '_', '*', 'W'], 
				['*', '_', '*', 'W', '*', '_', '*'], 
				['*', '*', 'W', '*', 'W', '*', '*'],
				['*', '_', '*', 'B', '*', '_', '*'], 
				['B', '*', '_', '*', '_', '*', 'B']],
				"W", False		
			),
			[[0,6], [2,2], [2,4]]
		)

class TestValidMoves(unittest.TestCase):
	def test_get_valid_moves_human(self):
		# Move B from back row
		self.assertEqual(
			get_valid_moves([
				['W', '*', 'W', '*', 'W', '*', 'W'], 
				['*', '_', '*', '_', '*', '_', '*'], 
				['*', '*', '_', '*', '_', '*', '*'],
				['*', '_', '*', '_', '*', '_', '*'], 
				['B', '*', 'B', '*', 'B', '*', 'B']],
				"B", "[4,0]", True
			),
			[[3,1]]
		)

		self.assertEqual(
			get_valid_moves([
				['W', '*', 'W', '*', 'W', '*', 'W'], 
				['*', '_', '*', '_', '*', '_', '*'], 
				['*', '*', '_', '*', '_', '*', '*'],
				['*', '_', '*', '_', '*', '_', '*'], 
				['B', '*', 'B', '*', 'B', '*', 'B']],
				"B", "[4,2]", True
			),
				[[3,1], [3,3]]
		)

		# Move B from the center of the board
		self.assertEqual(
			get_valid_moves([
				['W', '*', 'W', '*', 'W', '*', 'W'], 
				['*', '_', '*', '_', '*', '_', '*'], 
				['*', '*', 'B', '*', '_', '*', '*'],
				['*', '_', '*', '_', '*', '_', '*'], 
				['B', '*', '_', '*', 'B', '*', 'B']],
				"B", "[2,2]", True
			),
				[[1,1], [1,3]]
		)

		# Move B from the front row
		self.assertEqual(
			get_valid_moves([
				['W', '*', 'B', '*', 'W', '*', 'W'], 
				['*', '_', '*', '_', '*', '_', '*'], 
				['*', '*', '_', '*', '_', '*', '*'],
				['*', '_', '*', '_', '*', '_', '*'], 
				['B', '*', '_', '*', 'B', '*', 'B']],
				"B", "[0,2]", True
			),
				[]
		)

		# B is blocked by other B pieces
		self.assertEqual(
			get_valid_moves([
				['W', '*', 'W', '*', 'W', '*', 'W'], 
				['*', '_', '*', '_', '*', '_', '*'], 
				['*', '*', 'B', '*', 'B', '*', '*'],
				['*', '_', '*', 'B', '*', '_', '*'], 
				['B', '*', '_', '*', '_', '*', '_']],
				"B", "[3,3]", True
			),
			[]
		)

	def test_get_valid_moves_ai(self):
		# Move W from front row
		self.assertEqual(
			get_valid_moves([
				['W', '*', 'W', '*', 'W', '*', 'W'], 
				['*', '_', '*', '_', '*', '_', '*'], 
				['*', '*', '_', '*', '_', '*', '*'],
				['*', '_', '*', '_', '*', '_', '*'], 
				['B', '*', 'B', '*', 'B', '*', 'B']],
				"W", "[0,0]", False
			),
			[[1,1]]
		)

		self.assertEqual(
			get_valid_moves([
				['W', '*', 'W', '*', 'W', '*', 'W'], 
				['*', '_', '*', '_', '*', '_', '*'], 
				['*', '*', '_', '*', '_', '*', '*'],
				['*', '_', '*', '_', '*', '_', '*'], 
				['B', '*', 'B', '*', 'B', '*', 'B']],
				"W", "[0,2]", False
			),
				[[1,1], [1,3]]
		)

		# Move w from the center of the board
		self.assertEqual(
			get_valid_moves([
				['W', '*', 'W', '*', 'W', '*', 'W'], 
				['*', '_', '*', '_', '*', '_', '*'], 
				['*', '*', 'W', '*', '_', '*', '*'],
				['*', '_', '*', '_', '*', '_', '*'], 
				['B', '*', '_', '*', 'B', '*', 'B']],
				"W", "[2,2]", False
			),
				[[3,1], [3,3]]
		)

		# Move W from the back row
		self.assertEqual(
			get_valid_moves([
				['W', '*', '_', '*', 'W', '*', 'W'], 
				['*', '_', '*', '_', '*', '_', '*'], 
				['*', '*', '_', '*', '_', '*', '*'],
				['*', '_', '*', '_', '*', '_', '*'], 
				['B', '*', 'W', '*', 'B', '*', 'B']],
				"W", "[4,2]", False
			),
				[]
		)

		# W is blocked by other B pieces
		self.assertEqual(
			get_valid_moves([
				['_', '*', '_', '*', '_', '*', 'W'], 
				['*', '_', '*', 'W', '*', '_', '*'], 
				['*', '*', 'W', '*', 'W', '*', '*'],
				['*', '_', '*', '_', '*', '_', '*'], 
				['B', '*', 'B', '*', 'B', '*', 'B']],
				"W", "[1,3]", False
			),
			[]
		)

	def test_get_valid_moves_with_jump(self):
		# W can jump
		self.assertEqual(
			get_valid_moves([
				['_', '*', '_', '*', '_', '*', 'W'], 
				['*', '_', '*', 'W', '*', '_', '*'], 
				['*', '*', 'W', '*', 'W', '*', '*'],
				['*', '_', '*', 'B', '*', '_', '*'], 
				['B', '*', '_', '*', '_', '*', 'B']],
				"W", "[2,2]", False
			),
			[[3,1], [4,4]]
		)

		self.assertEqual(
			get_valid_moves([
				['_', '*', '_', '*', '_', '*', 'W'], 
				['*', '_', '*', 'W', '*', '_', '*'], 
				['*', '*', 'W', '*', 'W', '*', '*'],
				['*', '_', '*', 'B', '*', '_', '*'], 
				['B', '*', '_', '*', '_', '*', 'B']],
				"B", "[3,3]", True
			),
			[[1,1], [1,5]]
		)


if __name__ == "main":
	unittest.main()